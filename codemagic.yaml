# Automatically generated on 2022-06-23 UTC from https://codemagic.io/app/61f5d70bdd2148c3ff88c82c/settings
# Note that this configuration is not an exact match to UI settings. Review and adjust as necessary.

workflows:
  flutter-build-&-test:
    name: Flutter build & test
    max_build_duration: 30
    environment:
      vars:
        keys: Encrypted(Y29uc3QgU3RyaW5nIGJhc2VVcmwgPSAnaHR0cHM6Ly9nYXRld2F5Lm1hcnZlbC5jb20vJzsKCmNvbnN0IFN0cmluZyBhcGlQdWJsaWNLZXkgPSAnNTBjOTQ3ZjA0ZTlkMWIxMmE4N2QwMTljZjg0OTEyZTYnOwpjb25zdCBTdHJpbmcgYXBpUHJpdmF0ZUtleSA9ICcxNzExZDM1NTAzYmQ0ZTZjNDgxYmQ1MmY0ZDU0YTk4MzYyMDM1NzhkJzsK)
        FCI_KEYSTORE_PATH: /tmp/keystore.keystore
        FCI_KEYSTORE: Encrypted(Z0FBQUFBQml0RzhFVEdZcFItSWc1MVdLaENZbE1rY0J5YmtiWi1nRHpGZVFPaDVkeHp1NThTOVF1amo0NDBMZ2RlM09aWW5BaFV5TlR5Q1dPSmhLWlZUMW9KZVZReENJaVgxUFlIX3RnQ1VLYm4tWXU3WWY3aFJwLWRINHdOS2E1Q1Nmcmd3NE1JRi00dzNabjlGUmpjNFlmSmpNTVk0ZHc3WGlHWTFsNW1tUlExa1k1aUJwRmxiY2ZYTVkwMWQyTlM2dk82bEtpTDRObklhX0ZKRXpqcmdRN0FhWmQxRGlCc0MxbE0wel8wa2hYVVVEbXkyWkJVeUhMZjExY3F2b184cXBtbUFRNTNSYldLaFU2Zm5MckRyQ3dmX05GSXc0M0ZNV2d2aTUxSWhBbjN6M3VSa1czQm1lQ19lT1dzOEwyTWY4REtRTjY4Ukl6eFZWSVhMMUtVUnUwYzh2R0ZLRmNsdXZJSTc0U1h6UnU2emg5U3d6OXQ3M2xManpkTDNDbFdxSmdmdjRBTzVVQ1lnSEkxX1Zkb21qYjV4b20xdUx5bG1BSU0tQTBhemlZdTBtYlY1Vk40eGN1VkJKNmJfRzBIX0JEcDJ3MEJwNjlnZEhZbklRbjVKSkdDTmhkdEp5R2VneEI4cVItTUZfX3dmWmt6MHZUbGFDVm5kdTVmVVJxQmRTSlA0Zk5fY0xoOVdnd1dZc1Y3NlFsV3kzNDVHVEZCTWtudUpONjhsVklOMnItOWt6WFFYR1RZUUZvUF9lbGpIek9GbU1taXo2WHZRS0RsRjc3a1R1SXY4TUNRbTE0UmdXNllPc19IY0tCYk9TcW5Xak9nWVhPZnJ1SlJmTjJNY19ROVpsSHJRVUVoSndHc2IyVnhlS2FGaEhqZzZrdWpPdmtWalBXc0hNcnZCTld5YXZKcEp1VzhYZl9NaVZMYm5YRVZLMjFHZmtKbHBmQUF6N1Q2RUhCMUo0UlBlbm4zQ0xQUXZTUFB0REN1aXc4YXFTeTJfU0hUZUNRMTNyb2U1dXhpejNmdmhFcXR0R2xtR0wyb3pZdkFHTGFDUWE3MXV5UENGcjNBcGRvemZjVWpScDdibFdXNHNaV2c0OV9FMUNrLXEtNUVxby1mUER6bmFhUm1waVFHTFRGcFZZWGxXenhIOVFPTk9MSzktLVY4Q2xKdHJubUpWaFZBelRZcnBFNW1INzJzWVFKUlJvbjZzRFBGZE5KR1dYdXNNSC1EQno3U2E3VUtMTDRXZ29YZldOeDhHcDBaOC1OdGlZM3I4SmFQZ1FNem1GT3A3MU40ZUtuNVZYNGhNeHJ5eXQzZmJEUUg5N3p5a09pdVB1SG9Jd1ZNbW8yZHhaV3lwdDJqb1RlbzMySnJzWU1hWThieXlyU0R3LXFTbG1IbWp5X1JvRy15dnZaNFExdzlIRVU0bDZpMHVxVHM4U3FZek1tV1Y4S0JfdXhIOUVCaVdKd0N6WlY4amZ6QTBqYklxQnFraTZSSWhvd01DMk9GbGVkbkNhSEtZOGI1eTFKT1lrb1pkN2JlMEcxQWdKX2dzYjVoaGZ0dWJCUElHS2RfYVZ6b0JLTlp4ZzN4Q2NRRW45VzVCaWJtLVNETlduZHYzMFh6MnpNTjNRZnB0eGI4ajhQWjFyNDRLWVdYMjQ0dXkwWmR5d0VkLVc4WU5iZjdnLUVkMjN6U2VZdTZEX1hlLWxUR3JCSDRhMmMwbk1NYWRjM0RVVlRwS2xYTVBQZ0hVcEtBUXNqQVRfUmE5bGk3RDlLMGNIUTFIUVpPN1RBckJQbXJVY2lad2loeDRFNV9HS0ZwZ2FUX1JMc0JuYUZXQnBUMS1vVnE0UF9mbmlJVEstXzNYWGluZDNlaGcwOG5ISFd3N1Z0bHB6WFlfRmhMSFdSME9Gak9QV2MxVEZWN05OT3d2M0FzYW9HVGNaTl9NQnBINzdXUE5TSjdtUmlva1hLVlh4amRrTTByalFwa1REYXZ6VEw5RE9TUVpxSnl0MmltXzh4SWZrYkNXQzhfQ19YckhJdWZ4QUd2OURHNUd4NnQwTFF3dm5xVFRGUDNfRGZJVEFaTkw3VjY1OUxzQnhQckxZcTRPMFVnZ0g5WWtESlM3X2JPVjZOeVVEZEtEQmRRb2lBRk9fcnRuQXBMUFd2U2g4WkV0ejJXbDlxSVAybVJlRjNGdUxmMm1DdlhWSEJsNHNPb21mZ25CdVBzWFBzNGM3WjlJSHVYa3ZnUmhOVWgtUjdXREdLUGtDTm5mTWhLeTZqclFBUlJaUW5lRWdPVTU1TTNzc0tNNU94aXJtcG5XQjB6ZE9ESGRRRENCdXFNSWtlcUhtU1laYXRLM2dQT21KQmhuQjkzM0FsMHRfTmhRNXpZQVBsdHZwY1YxbVltTjlsbE9BeWptMzVRaXJoc2swRE0zdU5nOHByc3JYMjdFWUU1XzVoRGJ3bDhDMDVJUFI4MmUzb01JZU9jdFdZOFVnZjRKTDRzbkd5RVFWa051WTZCbW05V2JyVmQ3UVdreFNQLS1jVGh5VTU0SkZwUGVJWEhkVm1XMVA0cXl2bEVDNk9qV2VENzgzMHptTHVIXzRDR2JBTklpNTNEdFRoc0RMZ2VKTXdPaHptUWhVeWk4eFFub3QwaWpvTXlUOHkxSEh0b1g3aXNXLWRtWU5Hako2NVVuLXhJMHdkS3g0d1puSTdzY3p3Q0VTQkRFTDcyaVBnU003ZXhqaTZGZlFFSVMwclFPaTdhVjhQTFJiS2tDbF91MmJTWTNCVnVjSEFxUmEzM1JFN3pBVjlpMWhaeGpuUW5DdDFLUElCdGNQaGdsWkt6b1IyVVpYZWtLQXpQdjdIanc5TjFtcGFKamVaeGhmZVpIVTFvNnlUd05pZ19kbWtZbDdzUmtoTkhIRWZwT1M4Sm5GWVZ0NDI1T3E3Sm1tcG9Ub3RVaWlzaVVRRGptZG1xd1plZzU5dWZUbWJ0RFNuTUxGcmxTZXJ2RzlldVRLb3BnMEUtT29sSXZ2eXFMWk5JcGllUTdOcmhUSXQybl91VEcwTXQxYU9uUkhTWW9nSUtBTFFCcEZwWUJZbEhMMmpjZk12aE5KWTZ5ZFhTTFlNczNtRFZmRVF2TkFrS3pGYkdqQmp0SHRDbFd3b3hxTUp4MEdJQ0NrQlZld0hkZXdIUk5FZ09ORGlWVU1fcV9DTGt4a2lDZEdUOFlyeGNpTXpIbC1QX1NseEJaMGk3akFvVVFYX3p5Y1hTVlFzS0xWMEJxcnlER3l2TmVEOXlHT2gwRlZfSzlPWkVBUjJoYUZncXk3ZlNicnN6QXE5clVRVWdVc2Vvc1ltNkxoTTFGdUdqdFVDeVFka2RSU1FlcDU5MzluVXpObUhWR1dTaGNjRmxKZE1wSENMWC03LVA1ZVphWnhIdHg1RjNxTWFtLW1xNENYaXJwRXRLckxJRnY4bWZkeVdaWDMyQUdzXzdxMERWdXhmeDM5OEVLTW9Bakt3N09ocWFIZEo4MFhoczlaWHdfNG04Y094QXY4UVVqX0oxcXVUdWRrdnI3YTN0eVktVWtuNWEyTHVRTDRNY0NMSFVOd001SGhwbWJNb3IxSi1Ja05JZDBWSlZZczRaY1MtV1h3ZFlVTkFUUVdOT0tsZzctYWRRX1hBbHI5MkQxbXlhczUtZjU5NG5tR0xNV1c5V1Rjc2U5VUhBMTIyRENIcUVhYVJ1eHFRM05fWHVzQlZ3S2QybzJkVUdvWWVyY3pZbUhWbzlvTFFkX1Vfdi1Ebm5Zd0ktb3R5TWVyOHh3VzdWV0F1T1RENHN4SjNCSlVhQnVQQW15WW1reVNPb3Rrc1FzUGZNdldqb211NUhfbEw4NzZoQU1OQ29mWkJiRm1nbnFLTHJqb3luN2YxMTRJOVlYbjZPc3Y1eEw5ZWxkRmhZdU5OT1FHczFoTm5wTnV4dl9KbkN3bkJzVzkzM0J0Y1U1aW0wWVFlWmE5ZERSWGhfeGNiek9jZ3pxSkpMcXh2RmhvakpaRUFSQW9ScXl0RDQ4bDk4bDhvbUNkYkx0VUdoXzN4dFg5SS1sUlJkdnZvdzZTdFdzb3FFZU5YRVJwVjFORzRBLVpTNUg0ZUF5NFI4dVhYbHVoNEphU1JYUF8xVUFYSlFfU1N1ZXctM1JyRjMtY0Rhb0VwbWJJeEZmQzVWOXg2VE9QOGVKV1NiQWVWV3p4dVpNZm9jZWtHdTBxWnl0WW14cmhpZjZCWmZDNUVxcVlNTWF5OWlUcFBWUHdkUG9lVTdvaVFXVlZqVUNoY1htZmxEa0hIYnk2ZVRxNTBRZEZTUnNnOE1FUXhvUWVGanY5UkhQVWQ2Yk1pTG0wWnJhRFNWeGRWOW1kdW1Jd09GT1Z6QVdYNGlyYmJkTThfUVRVTTJtemEtZ3VZbGxnTGhvMFBpcjZUNEpNemlvTU5rN0J3eU4wRXE0RG9MRTJhRW1YTDFvaU9hNVRqalctdDdHQUE0c2sxemlQZ2lGek1mUWYwSElvNndJempscVloOWstOUFCQ2hkOGRhemQtWXFtTV9EbE1HMk16ME85cUF1bG53UlBZZ3dEbzgtRkhzdFZNbE1vcTA2VHA4SHNTQnItZE92VVhEZFB0emk4SkVoZzYtQmtldmI1WXg4S3FFUkhaVXNlRnUyeU91bmpCQ1Z6N3Z5aF9iMTZUbmRNSFdRVTgyNXFNQW1rdU9wZmd4QzBnUFdHM2hUa0VXVDBtNU8ycTEwQkFlRldCX3g1YkR0UzFOcHlNaFhBMmJZZ3c4RFpLNlpROF9HM1dycGd1QTNjb3g4R3RHR0czSVdxd3VwZExYNXN0WHVoaVFKcGFCbXlCSjNYblluZzJEdHc3YVlONnhXNExoYnpYRHFqbU1zTHIxcVZqUTRFQ0ktN0ZZNmZzTGlMQ0syZ09TUmJYTjFXVHdXNW44RkxXdWVPQVV6REtvTlNpTHlPaWgyTS1vcWprTjRPTXVfcTNuUkpJU3NCeWdZMkNDVzJOSm9iZUl6TEs1YlFUM2RpSVVRa2JDblBFeFRHNEU2MmxWbnl5a0tVOVhYYjhVbVk5Z096amE0WGdxTXB5c2JhLUNlTUFjSm16TFZqS21EajJzTzJBWmZyWVFyVzNjUkhFMmFnSGpxY1dRdTZEZnNtX2YtTmJDUFZ5c3U5dFpRM1VMTS1jVktUa3J4WkY1RXFaRng0UDJrMHJZTDVGdDlndXI5N0M4ekhfV0QxekJuQjROR2VndmhiWE1GMmdlUEJfeEw3bHE2RkJZd2VMSy15ZDhTWGtvbDNXWm9OVFNfNHpnamVvVGFPTDhLVUlTMlNFdGxEaDNOdlg1RnpLVU9oQWFrQUhSMThYVUNBX3lOR0E1cDBfRl9sUFktUl9wc2tBLThaVWpSTjM1WnJRVTU1aWxqMF9KaENNd0J2S05udENlbUZxNmR5V3E3Y3dUY3hNWUxHU3hWLUVZaFRIMDJkUndPWlZSQWZCQUYwVEdPbi1xckFzbGJoZUpla0hxUW80YlFPMVBBRThYVDd6dXNFQ0taN2p5R19MU3M4ZndVSzh1Wkx4eFlMamtqTDliYmRXLVNQR294SDB3RFN5RjUwMDFsVTZTSjV0ZGwzSnVxekpLUllCeXZhVVlMdFlmUVJJU0NlaGVQUEl1c3pUZ3RTc1lPdTZyajdXWEhTcXd4ajZaVFVneERsNzhvTjB5bnlXcC1meHhhd1dtVlQ1RkRrVVZkU2RWUmx0OU9BR2ZCTHBOWG5yQ0IyR2g4Rmd4TFBVempBZlZrOVFiUmpsNkZGNmNaVkV3UWFKRDhqM0EzNzRuRU5HMW52UDdNcmxqekxnclpRejlVLXBVT0xjdHc1aWpXdEpLVF83bGV6ZjZkMFpPX09kaHlRMnRrU2FNd0s4UkIzcUU0bFp1eGoyRW5aWDMyaDhqN1doWnYwcFJPNmktYlNVUUFBMmstcFRhSXQycG5HcGVncEJXVkRaWnE4dkwzTVlrbG1Db2d1c2FGRVIydE9fTEJFUzRrRmlFUWtrZ01nVlZvelZiS0k0d1VKZ2M4cld0ZXhfZUFhYnF3M1RMOVByM25mdkNjSUVCZWt0S0JhVWtSd09LTkRMTGxTM1hxVXZLUzg4RnZqU2k2WF8xU0hnUU9vdExIaUw0TGo2WVFZT0xxWnQ3NTcxVWtKTDVjalJneGRramZ3SGdJRWhHV0o2eEF0OTdKejNjcXIzb2pNa1VPUmpJV3Q4SEFBanZzX09WcXZsckllbFVOeWhIUWNXNWQyZjVmZkJGSjVHMHM1OEVBYjVvdWlJbl9TblMybTVWOUMzR2JQU1c5QU5NOGY0MHFWQWd4ejdoZUtqbjlacXN1QXZhX1I4QmZhckYxWG1uX3hWNGhrekxmU2lFWmRwNl9ya24zQkgxcHh6anlqd1lzQXpBYWVsZVJEWDZYRlV4NzZwdk9SN3VkY0drNVZlS0FHOHJlbEdIS0l3eU5ZSWp4OVNYYzR4YnJDdDNOYllad3Jtd1FuR3lpbFBqM2MyX0lDelg2MGxXLXp3MVNLU0cxZ2VsR2dJV3M3ZTNCSXNnOWxLbnI4YkhFQVlCTmxCSEoxellUQlk=)
        FCI_KEYSTORE_PASSWORD: Encrypted(Z0FBQUFBQml0RzhFTC05Y2VfNll4ZUw4NEVUc2l1TXdpNEp0RjF0alZCZHdSRGpoQmo3NWMwaUhNVnhxZG1oZldQTDdCeDY4a0VVMmR0a3NjcUp2UnJTNWNtNjRTNThpMlE9PQ==)
        FCI_KEY_PASSWORD: Encrypted(Z0FBQUFBQml0RzhFanRpaF9TY0Q5d29ncFAwcjNnd2ZlUVdQSVE4ZXktN29vcFFFempCVFJzSzF6eWJMQnZJSWM2dldibEM1ZmZYZV9CVGFSNmdkYnpvZHAxWmNsaXJSaWc9PQ==)
        FCI_KEY_ALIAS: Encrypted(Z0FBQUFBQml0RzhFdXRPcTNRdW5UTDY4Q0ZtV0NvY2NZMHBBejBKUU52d3VpVFRCMXlwZUMwTF94WG85VWtGdWJqdnRXQmJJaTFWUXc3WFVHbDlET1dDc0dTX09ZcVJJeGc9PQ==)
      flutter: stable
      xcode: latest
      cocoapods: default
    triggering:
      events:
        - push
        - pull_request
      branch_patterns:
        - pattern: '*'
          include: true
          source: true
      tag_patterns:
        - pattern: '*'
          include: true
    scripts:
      - |
        # set up key.properties
        echo $FCI_KEYSTORE | base64 --decode > $FCI_KEYSTORE_PATH
        cat >> "$FCI_BUILD_DIR/android/key.properties" <<EOF
        storePassword=$FCI_KEYSTORE_PASSWORD
        keyPassword=$FCI_KEY_PASSWORD
        keyAlias=$FCI_KEY_ALIAS
        storeFile=$FCI_KEYSTORE_PATH
        EOF
      - |
        # set up local properties
        echo "flutter.sdk=$HOME/programs/flutter" > "$FCI_BUILD_DIR/android/local.properties"
      - flutter packages pub get
      - |
        #!/bin/sh
        mkdir -p $FCI_BUILD_DIR/lib/secrets
        echo $keys | base64 --decode > $FCI_BUILD_DIR/lib/secrets/keys.dart
      - flutter analyze
      - flutter test
      - flutter build appbundle --release
      - |
        # generate signed universal apk with user specified keys
        android-app-bundle build-universal-apk \
          --bundle build/**/outputs/**/*.aab \
          --ks $FCI_KEYSTORE_PATH \
          --ks-pass $FCI_KEYSTORE_PASSWORD \
          --ks-key-alias $FCI_KEY_ALIAS \
          --key-pass $FCI_KEY_PASSWORD
    artifacts:
      - build/**/outputs/apk/**/*.apk
      - build/**/outputs/bundle/**/*.aab
      - build/**/outputs/**/mapping.txt
      - '*.snap'
      - build/windows/**/*.msix
      - flutter_drive.log
    publishing:
      email:
        recipients:
          - bk.koluch+codemagic@gmail.com
